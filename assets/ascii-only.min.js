// Austin - 10/20/20 - script to sanitize shipping/customer info and remove emojis/apostrophes
const query = {
    submitButton: 'button.step__footer__continue-btn', // the selector for Checkout Page submit button
    textInput: 'input.field__input' // the selector for Checkout Page text inputs (name, address, etc)
}, regex = /[^ \t-~]/g, submit = document.querySelector(query.submitButton);

document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll(query.textInput).forEach(e => {
        e.addEventListener('change', (event) => {
            let el = event.target, contains = regex.test(el.value), error = document.createElement('div');
            (el.maxLength = 40), (el.value = el.value.replace("'", ""));
            if (contains) {
                (el.style.borderColor = 'red'), (submit.opacity = 0.6), (submit.disabled = !0), (error.innerHTML = "Symbols & Emojis are not allowed"), (error.className = "error-message"), (error.style.marginTop = "6px"), (error.style.color = "red");
                if (!el.parentNode.querySelector('.error-message')) el.parentNode.appendChild(error);
            } else {
                (el.style.borderColor = '#d9d9d9'), (submit.opacity  = 1.0), (submit.disabled = !1);
                let rem = el.parentNode.querySelectorAll('.error-message');
                rem.forEach(e => e.remove());
            }
        });
    });
});